
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Monotonic Constraints &#8212; xgboost 0.80 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Feature Interaction Constraints" href="feature_interaction_constraint.html" />
    <link rel="prev" title="DART booster" href="dart.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="feature_interaction_constraint.html" title="Feature Interaction Constraints"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dart.html" title="DART booster"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xgboost 0.80 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">XGBoost Tutorials</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../index.html" class="text-logo">XGBoost</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../build.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get_started.html">Get Started with XGBoost</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">XGBoost Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model.html">Introduction to Boosted Trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="aws_yarn.html">Distributed XGBoost with AWS YARN</a></li>
<li class="toctree-l2"><a class="reference external" href="https://xgboost.readthedocs.io/en/latest/jvm/xgboost4j_spark_tutorial.html">Distributed XGBoost with XGBoost4J-Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="dart.html">DART booster</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Monotonic Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="feature_interaction_constraint.html">Feature Interaction Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_format.html">Text Input Format of DMatrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="param_tuning.html">Notes on Parameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_memory.html">Using XGBoost External Memory Version (beta)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discuss.xgboost.ai">XGBoost User Forum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">GPU support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameter.html">XGBoost Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R-package/index.html">R package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jvm/index.html">JVM package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../julia.html">Julia package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">CLI interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribute to XGBoost</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">XGBoost Tutorials</a></li>
              
              <li>Monotonic Constraints</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="monotonic-constraints">
<h1>Monotonic Constraints<a class="headerlink" href="#monotonic-constraints" title="Permalink to this headline">¶</a></h1>
<p>It is often the case in a modeling problem or project that the functional form of an acceptable model is constrained in some way. This may happen due to business considerations, or because of the type of scientific question being investigated.  In some cases, where there is a very strong prior belief that the true relationship has some quality, constraints can be used to improve the predictive performance of the model.</p>
<p>A common type of constraint in this situation is that certain features bear a <strong>monotonic</strong> relationship to the predicted response:</p>
<div class="math notranslate nohighlight">
\[f(x_1, x_2, \ldots, x, \ldots, x_{n-1}, x_n) \leq f(x_1, x_2, \ldots, x', \ldots, x_{n-1}, x_n)\]</div>
<p>whenever <span class="math notranslate nohighlight">\(x \leq x'\)</span> is an <strong>increasing constraint</strong>; or</p>
<div class="math notranslate nohighlight">
\[f(x_1, x_2, \ldots, x, \ldots, x_{n-1}, x_n) \geq f(x_1, x_2, \ldots, x', \ldots, x_{n-1}, x_n)\]</div>
<p>whenever <span class="math notranslate nohighlight">\(x \leq x'\)</span> is a <strong>decreasing constraint</strong>.</p>
<p>XGBoost has the ability to enforce monotonicity constraints on any features used in a boosted model.</p>
<div class="section" id="a-simple-example">
<h2>A Simple Example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>To illustrate, let’s create some simulated data with two features and a response according to the following scheme</p>
<div class="math notranslate nohighlight">
\[y = 5 x_1 + \sin(10 \pi x_1) - 5 x_2 - \cos(10 \pi x_2) + N(0, 0.01)
x_1, x_2 \in [0, 1]\]</div>
<p>The response generally increases with respect to the <span class="math notranslate nohighlight">\(x_1\)</span> feature, but a sinusoidal variation has been superimposed, resulting in the true effect being non-monotonic.  For the <span class="math notranslate nohighlight">\(x_2\)</span> feature the variation is decreasing with a sinusoidal variation.</p>
<img alt="Data in sinusoidal fit" src="https://raw.githubusercontent.com/dmlc/web-data/master/xgboost/monotonic/two.feature.sample.data.png" />
<p>Let’s fit a boosted tree model to this data without imposing any monotonic constraints:</p>
<img alt="Fit of Model with No Constraint" src="https://raw.githubusercontent.com/dmlc/web-data/master/xgboost/monotonic/two.feature.no.constraint.png" />
<p>The black curve shows the trend inferred from the model for each feature.  To make these plots the distinguished feature <span class="math notranslate nohighlight">\(x_i\)</span> is fed to the model over a one-dimensional grid of values, while all the other features (in this case only one other feature) are set to their average values.  We see that the model does a good job of capturing the general trend with the oscillatory wave superimposed.</p>
<p>Here is the same model, but fit with monotonicity constraints:</p>
<img alt="Fit of Model with Constraint" src="https://raw.githubusercontent.com/dmlc/web-data/master/xgboost/monotonic/two.feature.with.constraint.png" />
<p>We see the effect of the constraint.  For each variable the general direction of the trend is still evident, but the oscillatory behaviour no longer remains as it would violate our imposed constraints.</p>
</div>
<div class="section" id="enforcing-monotonic-constraints-in-xgboost">
<h2>Enforcing Monotonic Constraints in XGBoost<a class="headerlink" href="#enforcing-monotonic-constraints-in-xgboost" title="Permalink to this headline">¶</a></h2>
<p>It is very simple to enforce monotonicity constraints in XGBoost.  Here we will give an example using Python, but the same general idea generalizes to other platforms.</p>
<p>Suppose the following code fits your model without monotonicity constraints</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_no_constraints</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="p">,</span>
                                 <span class="n">num_boost_round</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">evallist</span><span class="p">,</span>
                                 <span class="n">early_stopping_rounds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Then fitting with monotonicity constraints only requires adding a single parameter</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params_constrained</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">params_constrained</span><span class="p">[</span><span class="s1">&#39;monotone_constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(1,-1)&quot;</span>

<span class="n">model_with_constraints</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params_constrained</span><span class="p">,</span> <span class="n">dtrain</span><span class="p">,</span>
                                   <span class="n">num_boost_round</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">evallist</span><span class="p">,</span>
                                   <span class="n">early_stopping_rounds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example the training data <code class="docutils literal notranslate"><span class="pre">X</span></code> has two columns, and by using the parameter values <code class="docutils literal notranslate"><span class="pre">(1,-1)</span></code> we are telling XGBoost to impose an increasing constraint on the first predictor and a decreasing constraint on the second.</p>
<p>Some other examples:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">(1,0)</span></code>: An increasing constraint on the first predictor and no constraint on the second.</li>
<li><code class="docutils literal notranslate"><span class="pre">(0,-1)</span></code>: No constraint on the first predictor and a decreasing constraint on the second.</li>
</ul>
<p><strong>Choice of tree construction algorithm</strong>. To use monotonic constraints, be
sure to set the <code class="docutils literal notranslate"><span class="pre">tree_method</span></code> parameter to one of <code class="docutils literal notranslate"><span class="pre">exact</span></code>, <code class="docutils literal notranslate"><span class="pre">hist</span></code>, and
<code class="docutils literal notranslate"><span class="pre">gpu_hist</span></code>.</p>
<p><strong>Note for the ‘hist’ tree construction algorithm</strong>.
If <code class="docutils literal notranslate"><span class="pre">tree_method</span></code> is set to either <code class="docutils literal notranslate"><span class="pre">hist</span></code> or <code class="docutils literal notranslate"><span class="pre">gpu_hist</span></code>, enabling monotonic
constraints may produce unnecessarily shallow trees. This is because the
<code class="docutils literal notranslate"><span class="pre">hist</span></code> method reduces the number of candidate splits to be considered at each
split. Monotonic constraints may wipe out all available split candidates, in
which case no split is made. To reduce the effect, you may want to increase
the <code class="docutils literal notranslate"><span class="pre">max_bin</span></code> parameter to consider more split candidates.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="dart.html" title="previous chapter (use the left arrow)">DART booster</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="feature_interaction_constraint.html" title="next chapter (use the right arrow)">Feature Interaction Constraints</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="feature_interaction_constraint.html" title="Feature Interaction Constraints"
             >next</a> |</li>
        <li class="right" >
          <a href="dart.html" title="DART booster"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xgboost 0.80 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >XGBoost Tutorials</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2016, xgboost developers. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>